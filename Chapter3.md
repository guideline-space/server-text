# インストール用ISOイメージの準備
OSのインストールには、ISOイメージのダウンロードが必要です。

2章の解説を参考にしてダウンロードしたISOイメージのファイルを用意しておきます。

# VirtualBoxのインストール
本教科書の実習では、仮想マシンソフトウェアである「VirtualBox」上にLinuxを導入して、その環境上に様々なサーバーを導入し実際に動作させます。

## VirtualBoxのダウンロード
VirutalBoxは、次のURLからダウンロードできます。

https://www.virtualbox.org/

ホストOSの種類に合わせてダウンロードを行えます。今回はWindows環境にインストールします。

左のメニューからDownloadsをクリックし、VirtualBox binariesからWindows hostsをクリックして、インストーラーをダウンロードします。

## Virtualboxのインストール
VirtualBoxのインストーラーをダウンロードしたら、インストーラーを起動してインストールします。

インストール時の特別な設定は行いませんので、インストーラーの指示に従ってインストールします。

インストーラーが仮想ネットワークのインストールについて、またPythonとの連携について確認を取ってきますが、そのまま進めても問題ありません。

インストール終了後、Finishボタンをクリックするとインストーラーが終了し、VirtualBoxが起動します。

# VirtualBoxの起動
VirtualBoxを起動します。

インストーラーが自動で起動した状態ではない場合には、デスクトップ上に追加されたVirtualBoxをダブルクリックして起動します。

VirtualBoxが起動すると、VirtualBoxマネージャーが表示されます

## VirtualBoxマネージャー
VirtualBoxマネージャーは、VirtualBoxによる仮想マシン実行環境全体を管理するツールです。主に以下のことが行えます。

・VirtualBox自身の各種設定
・仮想マシンの管理
・メディア（ISOイメージ等）の管理
・仮想ネットワークの管理

# 仮想マシンの作成
仮想マシンを作成します。

VirtualBoxマネージャーで新規(N)をクリックし、新しい仮想マシンの作成を開始します。各種設定を対話形式で設定していくガイド付きモードと、1つの画面で設定できるエキスパートモードが選択できます。ここではデフォルトのガイド付きモードで作成します。


## 仮想マシンの名前とOSの設定
まず最初に、仮想マシンの名前とOSの種類などを設定します。これらの設定は後から変更することもできるので、その他の項目で必要なものは後ほど設定を行います。

設定する項目と、設定する内容は以下の通りです。

名前：ServerA
タイプ：Linux
バージョン：Red Hat (64-bit)

設定しましたら、次へをクリックします。


## 仮想マシンのハードウェアの設定
仮想マシンのハードウェアの設定として、メインメモリーの容量とプロセッサの数を設定します。また、EFIの設定も行います。

メインメモリー：2048MB
Processors：1
Enable EFI(special OSes only)：チェックする

メインメモリーの容量は、使用しているコンピューターが搭載しているメモリ容量以下に制限されます。仮想マシンにある程度多めのメインメモリーを割り当てることで快適に動作させることができます。設定はデフォルトの2048MBでも動作しますが、余裕があれば4096MBから8192MB（4GBから8GB）ほど割り当ててもよいでしょう。

プロセッサの数は、使用しているコンピューターが搭載しているプロセッサのコア数以下に制限されます。また、プロセッサによっては仮想CPU機能により見かけ上コア数が2倍になっている場合もあります。設定はデフォルトの1つでも動作しますが、余裕があれば2から4ほど割り当ててもよいでしょう。

Enable EFIは、デフォルトではチェックされていません。OSのインストール画面のサイズが合わず一部の画面が見えなくなる問題が発生するため、チェックしておきます。

設定しましたら、次へをクリックします。

##仮想ハードディスクの設定
OSのインストール先となる仮想ハードディスクの設定をします。

Disk Size：20.00GB

仮想ハードディスクの容量は、使用しているコンピューターが搭載しているストレージの容量以下に制限されます。また、Pre-allocate Full Sizeのチェックをしない限り、仮想ハードディスクの容量はゲストOSが使用した分だけしか消費しませんので、設定は最大消費容量を指定することになります。

OSのインストールとサーバーの設定だけではそれほど沢山の容量を必要としませんが、実際に運用するサーバーを作る場合には必要な容量を見積もって設定する必要があります。また、後から仮想ハードディスクを追加することもできるので、追加方法について学習してもよいでしょう。

設定しましたら、次へをクリックします。

## 仮想マシンの設定を確認
最後に仮想マシンの設定を確認します。ここまでの手順で設定した内容が反映されているかどうか、あらためて確認します。確認後、完了をクリックします。

VirtualBoxマネージャーに、新しく作成した仮想マシンが追加されたことを確認します。

# 仮想マシンの設定変更
仮想マシンの設定を追加で変更します。

VirtualBoxマネージャーで仮想マシンを選択し、右側に表示される各種設定情報から変更が行えます。設定項目の見出し部分（「一般」や「システム」など」をクリックすると、その項目の設定画面が表示されます。

## EFIの有効化を確認
仮想マシン作成時にEFIの有効化を行っていないと、OSのインストーラーを起動した際に画面のサイズが合わず一部の画面が見えなくなる問題が発生します。

「システム」をクリックし、以下の設定にチェックが入っていることを確認します。チェックが入っていない場合にはチェックします。

EFIを有効化(一部のOSのみ)(E)：チェックする

確認、あるいは修正ができたら、OKをクリックします。

# ネットワークの追加 
ネットワークを追加します。

デフォルトではNATを使った外部ネットワークに接続するネットワークのみ設定されています。ホストマシンと仮想マシンが通信できるようにするため、ホストオンリーアダプターを追加します。

## 仮想ネットワークの設定を確認
VirtualBoxの仮想ネットワークの設定を確認します。

VirtualBoxマネージャーの「ツール」右側のリストボタン（横3本線）をクリックし、「ネットワーク」を選択します。「Host-only Networks」タブを選択し、「VirtualBox Host-Only Eternet Adapter」が存在していることを確認します。IPアドレスは、インストール時に自動的に作成された場合には192.168.56.1/24が設定されています。このIPアドレスは別の値に変更したり、追加した場合には第3オクテットが異なるIPアドレスがランダムで割り当てられます。

DHCPサーバーもデフォルトで有効になっていますが、本教科書の演習ではDHCPサーバーは使用しません。

## 仮想マシンにネットワークアダプターを追加
仮想マシンにネットワークアダプターを追加します。

VirtualBoxマネージャーから仮想マシンを選択し、右側の各種設定情報から「ネットワーク」を選択します。

仮想マシンには最大4つのネットワークアダプターを設定できます。アダプター1はNATが設定されているので、このままにしておけば外部のネットワークやその先にあるインターネットに接続できます。

アダプター2のタブを選択し、「ネットワークアダプターを有効化」をチェックします。「割り当て」を「ホストオンリーアダプター」に設定すると、「名前」に「VirtualBox Host-Only Ethernet Adapter」が設定されます。

設定したら、OKをクリックします。

# ISOイメージを仮想光学ドライブで読み込む設定
あらかじめ用意しておいたOSインストール用のISOイメージを、仮想マシンの仮想光学ドライブで読み込む設定をします。

VirtualBoxマネージャーから仮想マシンを選択し、右側の各種設定情報から「ストレージ」を選択します。

仮想マシンには、IDEとSATAの2種類のストレージデバイスが接続されています。仮想光学ドライブはIDEに接続されています。読み込む設定が何もされていない場合、「空」と表示されているのが仮想光学ドライブですので、選択します。

「光学ドライブ:IDE セカンダリマスター」の右にある円形のボタンをクリックし、「ディスクファイルを選択」を選択すると、ファイルダイアログが開きます。準備しておいたOSインストール用のISOイメージを選択し、「開く」をクリックします。「空」の表示がファイル名に変わります。

以上で仮想マシンの作成と、OSインストールの準備は完了です。
