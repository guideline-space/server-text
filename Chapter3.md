# VirtualBoxのインストール
本教科書の実習では、仮想マシンソフトウェアである「VirtualBox」上にLinuxを導入して、その環境上に様々なサーバーを導入し実際に動作させます。

## VirtualBoxのダウンロード
VirutalBoxは、次のURLからダウンロードすることができます。
https://www.virtualbox.org/

VirutalBoxのインストール先であるOSに合わせてダウンロードを行えます。
今回はWndows環境へインストールを行っていきます。

## VirtualBoxのセットアップ
VirtualBoxのインストールが完了したらセットアップを行っていきます。
まずVirtualBox-"バージョン"-Win.exeファイルをダブルクリックします。

VirtualBoxのセットアップを行うポップアップが表示されるため、「次へ」をクリックし進めます。
デフォルトの設定のまま「次へ」をクリックして進めます。
「はい」をクリックし進めます。
「インストール」をクリックしインストールを行います。

# VirtualBoxの起動
インストールが完了したVirtualBoxの起動を行います。デフォルトでインストールを進めるとデスクトップ上にVirtualBoxのアイコンが追加されます。アイコンをダブルクリックすることで、VirtualBoxマネージャーを起動させます。

# 仮想マシンの作成
VirtualBoxを使用し、仮想マシンの作成を行います。

新規(N)をクリックし、仮想マシンを作成していきます。
任意の名前を入力し、「タイプ」は「Linux」、「バージョン」は「Red Hat (64-bit)」を選択します。

# 仮想マシンの設定変更
仮想マシンの枠が作成出来たら、設定をいくつか変更していきます。

## UEFIの有効化（確認）
作成した仮想マシンを選択しそのまま起動すると、画面サイズが合わず見えない部分が出てくる場合があります。そのため、設定(S)をクリックし「EFI の有効化」にチェックを入れてください。

## ネットワークの追加 

## ISOイメージファイルのマウント
作成した仮想マシンをダブルクリックします。

ファイルアイコンをクリックし、ISOイメージをダウンロードしたフォルダ配下から選択します。
ISOファイルを選択して進めると仮想マシンが起動します。

# OSのインストール
それでは、インストールを開始します。

## インストールメディアの読み込み
1. 起動画面が現れます。

2. ↓↑などのキーを使ってメニューを選択します。「Install AlmaLinux 9」を選択し、Enterキーを押すとインストールが始まります。
「Test this media & Install AlmaLinux 9」を選択すると、メディアの内容の整合性をチェックし、問題がなければインストールが始まります。

## 言語選択
1. 言語の選択画面が表示されるので、左側のメニューから「日本語 Japanese」を選択します。画面右側のメニューに「日本語（日本）」と表示されます。

2. 「続行」をクリックします。すると、インストールメニュー画面が表示されます。

「!」が付いた項目は、必ず設定を行わなければならない項目です。

## インストール先ディスクの設定
1. 「インストール先」のアイコンをクリックします。すると、「インストール先のディスク設定」画面が表示されます。

2. 「ローカルの標準ディスク」の欄で、利用するディスクを選択します。

3. 「パーティション構成」の欄の「パーティションを自動構成する」を選択します。

4. 「完了」をクリックします。 すると、インストールメニュー画面に戻ります。

## ネットワークとホスト名の設定
1. 「ネットワークとホスト名」のアイコンをクリックします。 す
ると、「ネットワーク設定」画面が表示されます。

2. 「ホスト名」の欄に、ホスト名を入力します。入力後、「適用」をクリックします。 適用されると、右側の「設定」ボタンの下にホスト名が表示されます。

3. 「設定」をクリックします。次のような画面が表示されます。

4. 「IPv4のセッティング」タブをクリックします。すると、次のような画面が表示されます。

5. 「方式」を「手動」に変更します。

6. アドレスの欄の「追加」をクリックすると、アドレス、ネットマスク、ゲートウェイの項目が入力できるようになります。各項目に設定を行います。

7. 「DNSサーバー」にDNSサーバーのアドレスを入力します。

8. 設定が終わったら「保存」をクリックします。

9. ネットワークとホスト名の設定画面に戻ります。「オフ」になっているスイッチをクリックして、「オン」に変更します。

先ほど設定したアドレス、サブネットマスク、デフォルトゲートルート、DNSの値が表示され、ネットワークが有効になります。

10. 「完了」をクリックして、インストールメニュー画面に戻ります。

## ソフトウェアの選択
1. 「ソフトウェアの選択」のアイコンをクリックします。「ソフトウェアの選択」画面が表示されます。

2. ベース環境メニューから「最小限のインストール」を選択します。

3. 設定ができたら、「完了」をクリックして、インストールメニューに戻ります。
自動的にソフトウェアの依存関係のチェックが行われます。チェックが終わると「︕」がはずれ、「インストール開始」がクリックできるようになります。

## インストールの開始とパスワード設定
1. 「インストール開始」をクリックすると、インストールが始まり、「インストール状況の表示」画面が表示されます。

2. 「ROOTパスワード」のアイコンをクリックします。rootパスワードの設定画面が表示されます。

3. 「rootパスワード」「確認」の項目に、rootのパスワードを入力します。英文字の大文字、小文字、数字、記号などを組み合わせて、複雑なパスワードを設定します。パスワードの強度が足りない場合や、２つのパスワードが一致しない場合には、画面の最下部に警告メッセージが表示されます。
「このユーザーを管理者にする」にチェックを入れることで、sudo による管理者権限でのコマンド実行が可能となります。

4. 設定ができたら「完了」をクリックして、「インストール状況の表示」画面に戻ります。

5. 「ユーザの作成」のアイコンをクリックします。「ユーザの作成」画面が表示されます。ここでは、管理ユーザを設定します。

6. ユーザ名に管理ユーザの名前を入力します。どのような名前でも構いませんが、本書では、adminを入力します。

7. 「このユーザを管理者にする」「このアカウントを使用する場合にパスワードを必要とする」をクリックし、チェックします。

8. 「パスワード」「パスワードの確認」に、管理ユーザのパスワードを入力します。パスワードの強度が足りない場合や、２つのパスワードが一致しない場合には、画面の最下部に警告メッセージが表示されます。

9. 「完了」をクリックして、インストール状況の表示画面に戻ります。

10. インストールが完了すると、次のような画面が表示されます。

## インストール後の初期設定
1. 再起動すると、ブートローダーが起動するOSの選択を求めてきます。そのまま待つかEnterキーを押します。

2. 起動プロセスが進み、「初期セットアップ」画面が表示されます。

3. 「LICENSE INFORMAITON」のアイコンをクリックします。すると、「ライセンス情報」画面が表示されます。

4. 「ライセンス契約に同意します。」のチェックボックスをクリックします。

5. 「完了」をクリックし、「ライセンス情報」画面に戻ります。

6. 「設定の完了」ボタンをクリックすると、初期設定作業はすべて完了です。

# 初期起動後の設定
ログイン画面が表示されるので、管理者ユーザーadminでログインします。

1. ユーザ名をクリックします。すると、パスワード入力欄が表示されます。

2. adminのパスワードを入力します。

3. 最初にログインすると、「ようこそ」の画面が表示されます。

4. 使用言語が「日本語」になっていることを確認して、「次へ」をクリックします。すると、「入力」画面が表示されます。

5. 「日本語（かな漢字）」を選択して、「次へ」をクリックします。すると「プライバシー」画面が表示されます。

6. 「次へ」をクリックします。「オンラインアカウントへの接続」画面が表示されます。

7. サーバーの管理には不要な項目ですので、「スキップ」をクリックします。すると、「準備完了」画面が表示されます。

8. 「AlmaLinuxを使い始める」ボタンをクリックすると、ウィザードが終了します。

# ネットワーク接続の確認
## インターネット接続
## ホスト接続

# パッケージ管理ツールの利用
## dnfコマンド
RHEL 系 OS は 8 系からシステムに python3 が使用され、python2 は廃止となりました。
今までのパッケージ管理コマンドである yum は python2 系で記載されており、この変更によって使い続けることができず python3 系で動く dnf へとコマンドが変更されました。

## check-update
dnf check-updateコマンドで現在インストールしているパッケージについて更新が可能なものがあるのか確認を行います。

## update
dnf updateコマンドでパッケージを最新のものに更新します。
パッケージ名を指定せずに実行した場合はインストールされているパッケージすべてが対象となり更新されます。

## install
パッケージのバージョンを指定し、依存関係のあるパッケージを含めインストールを行います。

# Webサーバーのインストール
## 必要なパッケージを確認
DNSキャッシュサーバーの構築に必要なパッケージは、unboundです。また、DNSサーバーの動作確認には、bind-utilsパッケージが必要です。rpm コマンドに-qオプションとパッケージ名を指定し、パッケージがインストールされているか確認します。パッケージがイ
ンストールされている場合には、次のように表示されます。


パッケージがインストールされていない場合には、次のように表示
されます。

## ペッケージのインストール
unboundパッケージがインストールされていない時には、dnfコマンドでインストールします。インターネットに接続できない環境では、GUIからadminでログインし、インストールメディアが自動マウントされた状態でインストール作業を進めます。

dnf install bind bind-utils

## リクエストを受け付けるIPアドレスの設定
/etc/unbound/local.d/interface.confファイルを作成し、DNSキャッシュサーバーがリクエストを受け付けるIPアドレスの設定をします。
講師PCのIPアドレスと、ループバックアドレスを許可します。

## 利用可能なクライアントの設定
DNSキャッシュサーバーは、不正に利用されないように必ず利用者を制限して使います。/etc/unbound/local.d/client.confファイルを作成し、このDNSキャッシュサーバーを利用できるクライアントの設定を行います。ここでは、192.168.1.0/24のネットワーク全体を許可します。

## 受講者用ドメインの設定
演習の環境では、jpドメインの管理サーバーにalpha.jp、beta.jpという受講者用のドメインを登録することができません。そのため、DNSキャッシュサーバーに特別にスタブゾーンの設定を行います（この設定は、正式にドメイン名を取得した場合には不要な設定で
す）。 設定のために、次のような/etc/unbound/conf.d/stub.confファイルを作成します。

# サービスの起動/停止と動作確認
## サービスの再起動
systemctl restart named

## サービスの自動起動設定
 systemctl enable named

## サービスの確認
systemctl status named



